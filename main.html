<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
</head>
<style>
    body {
        background-image: url("https://i.pinimg.com/originals/2e/aa/a1/2eaaa1c4a692708637e0e3c1d569f958.png");
        background-repeat: no-repeat;
        background-size: cover;
        background-position: center;
        height: 100vh;
        width: 100vw;
        padding: 0;
        margin: 0;
        overflow: hidden;
    }

    canvas {
        box-shadow: rgba(14, 30, 37, 0.12) 0px 2px 4px 0px, rgba(14, 30, 37, 0.32) 0px 2px 16px 0px;
        border: none !important;
        position: absolute;
        top: 0;
        left: 0;
    }

    img {
        object-fit: cover;
        height: 100vh;
        width: 100vw;
    }

    .panel {
        user-select: none;
        position: absolute;
        z-index: 10;
        width: 200px;
    }

    .panel p {
        line-height: 1rem;
    }

    .panel input {
        margin-top: 5px;
        width: 100%;
        box-sizing: border-box;
        -moz-box-sizing: border-box;
        -webkit-box-sizing: border-box;
    }

    .panel input[type="checkbox"] {
        width: auto;
    }

    .panel #bg {
        /* From https://css.glass */
        background: rgba(255, 255, 255, 0.41);
        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(5px);
        -webkit-backdrop-filter: blur(5px);
        border: 1px solid rgba(255, 255, 255, 0.25);
        width: 100%;
        height: 100%;
        z-index: 10;

        position: absolute;
    }

    .panel #control {
        padding: 10px;
        position: relative;
        z-index: 100;

        overflow-y: auto;
    }

    .panel #btn {
        width: 100%;
    }
</style>

<body>
    <div class="panel">
        <div id="bg"></div>
        <div id="control">
            <div id="ball-1">
                <h3>Ball 1</h3>
                <p>accelerate: <span id="a-1"></span></p>
                <p>velocity: <span id="v-1"></span></p>
                <p>coordinate: <span id="coor-1"></span></p>
                <p>degree(&deg;C): <input type="number" id="alpha-1" /></p>
                <p>mass: <input type="number" id="m-1" /></p>
                <p>size: <input type="number" id="size-1" /></p>
                <p>string length: <input type="number" id="length-1" /></p>
            </div>
            <div id="ball-2">
                <h3>Ball 2</h3>
                <p>accelerate: <span id="a-2"></span></p>
                <p>velocity: <span id="v-2"></span></p>
                <p>coordinate: <span id="coor-2"></span></p>
                <p>degree (&deg;C): <input type="number" id="alpha-2" /></p>
                <p>mass: <input type="number" id="m-2" /></p>
                <p>size: <input type="number" id="size-2" /></p>
                <p>string length: <input type="number" id="length-2" /></p>
            </div>
            <div id="general">
                <h3>General</h3>
                <p>sec per step: <input type="number" id="time" /></p>
                <p>gravity: <input type="number" id="g" /></p>
            </div>
            <div id="shadow">
                <p>shadow: <input type="checkbox" id="shadow" /></p>
            </div>
        </div>
    </div>
    <canvas id="canvas" style="border:1px solid #d3d3d3;"></canvas>
</body>
<script>

    var boder = 30;
    document.getElementsByTagName("canvas")[0].style.margin = `${boder}px`;
    document.getElementsByClassName("panel")[0].setAttribute("style", `top:${boder}px;left:${boder}px;bottom:${boder}px`);
    document.getElementById("shadow").checked = true;
    document.getElementById("alpha-1").addEventListener('input', (event) => {
        alpha1 = parseFloat(event.target.value) * (Math.PI / 180)
    })
    document.getElementById("alpha-2").addEventListener('input', (event) => {
        alpha2 = parseFloat(event.target.value) * (Math.PI / 180)
    })
    document.getElementById("m-1").addEventListener('change', (event) => {
        m1 = parseFloat(event.target.value)
    })
    document.getElementById("m-2").addEventListener('change', (event) => {
        m2 = parseFloat(event.target.value)
    })
    document.getElementById("size-1").addEventListener('change', (event) => {
        ballSize1 = parseFloat(event.target.value)
    })
    document.getElementById("size-2").addEventListener('change', (event) => {
        ballSize2 = parseFloat(event.target.value)
    })
    document.getElementById("length-1").addEventListener('change', (event) => {
        l1 = parseFloat(event.target.value)
    })
    document.getElementById("length-2").addEventListener('change', (event) => {
        l2 = parseFloat(event.target.value)
    })
    document.getElementById("time").addEventListener('change', (event) => {
        time = parseFloat(event.target.value)
    })
    document.getElementById("g").addEventListener('change', (event) => {
        g = parseFloat(event.target.value)
    })
    document.getElementById("shadow").addEventListener('change', (event) => {
        showShadow = event.target.checked
        colorCoor = []
    })

    var c, draw, action;

    var showShadow = false;

    // cravitational constant
    var g = Math.PI * Math.PI;

    // ball coor
    var x1, y1, x2, y2;

    // string length
    var l1 = 200;
    var l2 = 200;

    // angle
    var alpha1 = 0;
    var alpha2 = 0;

    // acceleration
    var a1 = 0;
    var a2 = 0;

    // velocity
    var v1 = 0;
    var v2 = 0;

    // mass (ball's weight) 
    var m1 = 10;
    var m2 = 10;

    // size of ball
    var ballSize1 = 20;
    var ballSize2 = 20;

    // sec per step
    var time = 10;

    // the origin coor 
    var x = window.innerWidth / 2;
    var y = 100;

    // drag action catch
    var dragok = false;
    var dragCoor = 0

    // shadow coor
    var colorCoor = [];

    // hover action
    var hoverOn = false
    var ballHoveredId

    function setUpCanvas() {
        c = document.getElementById("canvas");

        c.width = window.innerWidth - boder * 2;
        c.height = window.innerHeight - boder * 2;

        draw = c.getContext("2d");

        x = c.width / 2;
        y = c.height - (c.height - 100);
    }

    function findAngle(A, B, C) {
        var AB = Math.sqrt(Math.pow(B.x - A.x, 2) + Math.pow(B.y - A.y, 2));
        var BC = Math.sqrt(Math.pow(B.x - C.x, 2) + Math.pow(B.y - C.y, 2));
        var AC = Math.sqrt(Math.pow(C.x - A.x, 2) + Math.pow(C.y - A.y, 2));
        return Math.acos((BC * BC + AB * AB - AC * AC) / (2 * BC * AB));
    }

    function begin() {
        setUpCanvas()
        calXY();
        updatePanelValue();
        window.requestAnimationFrame(render)

        c.onmousedown = myDown;
        c.onmouseup = myUp;
        c.onmousemove = ballHover

        c.ontouchstart = togglePlay;

        document.addEventListener('keydown', function (event) {
            if (event.code == 'Enter') {
                togglePlay()
            }
        }, true);
    }

    function togglePlay() {
        if (!action) {
toggleInput(false) ;
            action = setInterval(function () {
                dragok = false;
                cal();
            });
        } else {
toggleInput(true) ;
            clearInterval(action)
            action = null;
            dragok = true;
        }
    }

    function calXY() {
        x1 = l1 * Math.sin(alpha1) + x;
        y1 = l1 * Math.cos(alpha1) + y;
        x2 = l1 * Math.sin(alpha1) + l2 * Math.sin(alpha2) + x;
        y2 = l1 * Math.cos(alpha1) + l2 * Math.cos(alpha2) + y;
    }

    function calA() {
        a1 = (-g * (2 * m1 + m2) * Math.sin(alpha1) - m2 * g * Math.sin(alpha1 - 2 * alpha2) - 2 * Math.sin(alpha1 - alpha2) * m2 * (v2 * v2 * l2 + v1 * v1 * l1 * Math.cos(alpha1 - alpha2))) / (l1 * (2 * m1 + m2 - m2 * Math.cos(2 * alpha1 - 2 * alpha2)));
        a2 = (2 * Math.sin(alpha1 - alpha2) * (v1 * v1 * l1 * (m1 + m2) + g * (m1 + m2) * Math.cos(alpha1) + v2 * v2 * l2 * m2 * Math.cos(alpha1 - alpha2))) / (l2 * (2 * m1 + m2 - m2 * Math.cos(2 * alpha1 - 2 * alpha2)));
    }

    function cal() {
        v1 += a1 / time;
        v2 += a2 / time;
        alpha1 += v1 / time;
        alpha2 += v2 / time;
        calA();
    }

    function render() {
        calXY();
        draw.clearRect(0, 0, c.width, c.height);

        if (showShadow) shadow();

        // line
        draw.beginPath();
        draw.moveTo(x, y);
        draw.lineTo(x1, y1);
        draw.lineTo(x2, y2);
        draw.lineCap = 'round';
        draw.lineWidth = 5;
        draw.strokeStyle = 'black';
        draw.stroke();
        draw.closePath();

        // render 1st ball 
        draw.fillStyle = (hoverOn && ballHoveredId === 1) ? "blue" : 'black'
        draw.beginPath();
        draw.arc(x1, y1, ballSize1, 0, 2 * Math.PI);
        draw.closePath();
        draw.stroke();
        draw.fill();
        draw.closePath();

        // render 2nd ball
        draw.fillStyle = (hoverOn && ballHoveredId === 2) ? "red" : 'black'
        draw.beginPath();
        draw.arc(x2, y2, ballSize2, 0, 2 * Math.PI);
        draw.closePath();
        draw.stroke();
        draw.fill();
        draw.closePath();

        draw.fillStyle = 'black'
        draw.font = '36px serif';
        draw.textAlign = "center"
        draw.beginPath();
        draw.fillText(`Press "Enter" to ${action ? "pause" : "start"}`, c.width / 2, c.height - 50);
        draw.closePath()

        if (action || document.body.style.cursor === "grabbing") {
            updatePanelValue();
        }
        window.requestAnimationFrame(render)
    }

    function updatePanelValue() {
        document.getElementById("a-1").innerHTML = Math.abs(a1 * time).toFixed(2);
        document.getElementById("v-1").innerHTML = Math.abs(v1 * time * time).toFixed(2);
        document.getElementById("coor-1").innerHTML = `(${Math.round(x1)}, ${Math.round(y1)})`;
        document.getElementById("alpha-1").value = Math.round((alpha1 * 180 / Math.PI) % 180);
        document.getElementById("m-1").value = m1;
        document.getElementById("size-1").value = ballSize1;
        document.getElementById("length-1").value = Math.round(l1);

        document.getElementById("a-2").innerHTML = Math.abs(a2 * time).toFixed(2);
        document.getElementById("v-2").innerHTML = Math.abs(v2 * time * time).toFixed(2);
        document.getElementById("coor-2").innerHTML = `(${Math.round(x2)}, ${Math.round(y2)})`;
        document.getElementById("alpha-2").value = Math.round((alpha2 * 180 / Math.PI) % 180);
        document.getElementById("m-2").value = m2;
        document.getElementById("size-2").value = ballSize2;
        document.getElementById("length-2").value = Math.round(l2);

        document.getElementById("time").value = time;
        document.getElementById("g").value = g.toFixed(2);
        document.getElementById("shadow").checked = showShadow;
    }

function toggleInput(isDisable) 
{

document.getElementById("alpha-1").disabled = isDisable;
        document.getElementById("m-1").disabled = isDisable;
        document.getElementById("size-1").disabled = isDisable;
        document.getElementById("length-1").disabled = isDisable;

        document.getElementById("alpha-2").disabled = isDisable;
        document.getElementById("size-2").disabled = isDisable;
        document.getElementById("length-2").disabled = isDisable;

        document.getElementById("time").disabled = isDisable;
        document.getElementById("g").disabled = isDisable;
        document.getElementById("shadow").disabled = isDisable;
} 

    function shadow() {
        if (colorCoor.length <= 5)
            colorCoor.push([x1, y1, x2, y2]);
        else {
            colorCoor.shift();
            colorCoor.push([x1, y1, x2, y2]);
        }
        for (var i = 0; i < colorCoor.length; i++) {
            draw.beginPath();
            draw.arc(colorCoor[i][0], colorCoor[i][1], ballSize1, 0, 2 * Math.PI);
            draw.arc(colorCoor[i][2], colorCoor[i][3], ballSize2, 0, 2 * Math.PI);
            draw.fillStyle = 'hsl(' + i * 15 + ',100%,50%)';
            draw.fill();
            draw.closePath();
        }
    }

    function ballHover(e) {
        if (e.pageX < x1 + ballSize1 + c.offsetLeft &&
            e.pageX > x1 - ballSize1 + c.offsetLeft &&
            e.pageY < y1 + ballSize1 + c.offsetTop &&
            e.pageY > y1 - ballSize1 + c.offsetTop) {

            hoverOn = true
            document.body.style.cursor = action ? "not-allowed" : "grab"
            ballHoveredId = 1
        } else
            if (e.pageX < x2 + ballSize2 + c.offsetLeft &&
                e.pageX > x2 - ballSize2 + c.offsetLeft &&
                e.pageY < y2 + ballSize2 + c.offsetTop &&
                e.pageY > y2 - ballSize2 + c.offsetTop) {

                hoverOn = true
                document.body.style.cursor = action ? "not-allowed" : "grab"
                ballHoveredId = 2
            } else {
                hoverOn = false
                document.body.style.cursor = "default"
                ballHoveredId = 0
            }
    }

    function myMove1(e) {
        if (dragok) {
            x1 = dragCoor.x + (e.pageX - c.offsetLeft);
            y1 = dragCoor.y + (e.pageY - c.offsetTop);
            l1 = Math.sqrt((x - x1) * (x - x1) + (y - y1) * (y - y1))
            alpha1 = (findAngle({ x: x, y: c.height }, { x: x, y: y }, { x: x1, y: y1 })) * (x1 < x ? -1 : 1)

            // alpha2 = (find_angle({x:x1, y:c.height},{x:x1,y:y1},{x:x2,y:y2})) * (x2<x1? -1:1)
            // l2 = Math.sqrt((x1-x2)*(x1-x2) + (y1-y2)*(y1-y2))

            x2 = l1 * Math.sin(alpha1) + l2 * Math.sin(alpha2) + x;
            y2 = l1 * Math.cos(alpha1) + l2 * Math.cos(alpha2) + y;
        }
    }

    function myMove2(e) {
        if (dragok) {
            x2 = dragCoor.x + (e.pageX - c.offsetLeft);
            y2 = dragCoor.y + (e.pageY - c.offsetTop);

            l2 = Math.sqrt((x1 - x2) * (x1 - x2) + (y1 - y2) * (y1 - y2))
            alpha2 = (findAngle({ x: x1, y: c.height }, { x: x1, y: y1 }, { x: x2, y: y2 })) * (x2 < x1 ? -1 : 1)
        }
    }

    function myDown(e) {
        if (document.body.style.cursor === "grab") {
            document.body.style.cursor = "grabbing"
        }
        if (e.pageX < x1 + ballSize1 + c.offsetLeft && e.pageX > x1 - ballSize1 +
            c.offsetLeft && e.pageY < y1 + ballSize1 + c.offsetTop &&
            e.pageY > y1 - ballSize1 + c.offsetTop) {
            dragCoor = {
                x: x1 - (e.pageX - c.offsetLeft),
                y: y1 - (e.pageY - c.offsetTop)
            }
            dragok = true;
            c.onmousemove = myMove1;
        } else if (e.pageX < x2 + ballSize2 + c.offsetLeft && e.pageX > x2 - ballSize2 +
            c.offsetLeft && e.pageY < y2 + ballSize2 + c.offsetTop &&
            e.pageY > y2 - ballSize2 + c.offsetTop) {
            dragCoor = {
                x: x2 - (e.pageX - c.offsetLeft),
                y: y2 - (e.pageY - c.offsetTop)
            }
            dragok = true;
            c.onmousemove = myMove2;
        }
    }

    function myUp() {
        dragok = false;
        c.onmousemove = ballHover
        if (document.body.style.cursor === "grabbing") {
            document.body.style.cursor = "grab"
        }
    }

    begin()

</script>

</html>
